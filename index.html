<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Form Data Kelahiran - Unduh Word</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .container {
    background: #fff;
    border-radius: 12px;
    padding: 24px 30px;
    width: 320px;
    max-width: 90vw;
    box-shadow: 0 16px 32px rgba(102,166,255,0.25);
    overflow-y: auto;
    max-height: 600px;
  }
  h1 {
    font-weight: 600;
    text-align: center;
    color: #1a237e;
    margin-bottom: 12px;
    font-size: 24px;
  }
  form {
    display: flex;
    flex-direction: column;
  }
  label {
    font-weight: 500;
    margin-bottom: 6px;
    color: #333;
    font-size: 14px;
  }
  input[type="text"],
  input[type="date"] {
    padding: 10px 12px;
    border-radius: 8px;
    border: 1.8px solid #cfd8dc;
    font-size: 14px;
    outline: none;
    margin-bottom: 18px;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus,
  input[type="date"]:focus {
    border-color: #3f51b5;
  }
  .gender-group {
    margin-bottom: 18px;
    display: flex;
    justify-content: flex-start;
    gap: 16px;
  }
  .gender-group input[type="radio"] {
    display: none;
  }
  .gender-group label {
    background: #e8eaf6;
    padding: 10px 20px;
    border-radius: 20px;
    font-weight: 500;
    color: #3949ab;
    cursor: pointer;
    transition: background-color 0.3s ease, color 0.3s ease;
    user-select: none;
  }
  .gender-group input[type="radio"]:checked + label {
    background-color: #3949ab;
    color: white;
  }
  button {
    background-color: #3949ab;
    color: white;
    font-weight: 600;
    font-size: 16px;
    padding: 12px;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin-top: 8px;
  }
  button:hover, button:focus {
    background-color: #283593;
  }
  .output {
    margin-top: 24px;
    border-top: 1px solid #cfd8dc;
    padding-top: 16px;
    color: #1a237e;
  }
  .output h2 {
    margin-bottom: 16px;
    font-size: 18px;
    font-weight: 600;
  }
  .output p {
    font-size: 15px;
    margin: 6px 0;
  }
  .error {
    color: #d32f2f;
    font-size: 13px;
    margin: -14px 0 14px 2px;
    height: 18px;
  }
  .saved-list {
    margin-top: 20px;
    border-top: 1px solid #cfd8dc;
    padding-top: 16px;
    max-height: 200px;
    overflow-y: auto;
  }
  .saved-list h2 {
    font-size: 18px;
    font-weight: 600;
    color: #1a237e;
    margin-bottom: 12px;
  }
  .record {
    background: #e8eaf6;
    margin-bottom: 12px;
    border-radius: 10px;
    padding: 8px 12px;
    font-size: 14px;
    color: #2c387e;
  }
  .record p {
    margin: 4px 0;
  }
  .btn-group {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-top: 12px;
  }
  .search-container {
    margin-top: 12px;
    margin-bottom: 12px;
  }
  .search-container input {
    width: 100%;
    padding: 10px 12px;
    font-size: 14px;
    border-radius: 8px;
    border: 1.8px solid #cfd8dc;
    outline: none;
    transition: border-color 0.3s ease;
  }
  .search-container input:focus {
    border-color: #3f51b5;
  }

  @media (max-width: 400px) {
    .container {
      width: 90vw;
      padding: 20px;
    }
    button {
      font-size: 14px;
      padding: 10px;
    }
  }
</style>
</head>
<body>
  <div class="container" role="main">
    <h1>Form Data Kelahiran</h1>

    <form id="birthForm" novalidate>
      <label for="childName">Nama Anak</label>
      <input aria-required="true" type="text" id="childName" name="childName" placeholder="Masukkan nama anak" required />

      <label for="placeOfBirth">Tempat Lahir</label>
      <input aria-required="true" type="text" id="placeOfBirth" name="placeOfBirth" placeholder="Masukkan tempat lahir" required />

      <label for="dateOfBirth">Tanggal Lahir</label>
      <input aria-required="true" type="date" id="dateOfBirth" name="dateOfBirth" required />

      <label>Jenis Kelamin</label>
      <div role="radiogroup" aria-required="true" aria-labelledby="genderLabel" class="gender-group" id="genderGroup">
        <input type="radio" id="male" name="gender" value="Laki-laki" />
        <label for="male">Laki-laki</label>
        <input type="radio" id="female" name="gender" value="Perempuan" />
        <label for="female">Perempuan</label>
      </div>
      <div id="genderError" class="error" aria-live="polite" aria-atomic="true"></div>

      <label for="parentName">Nama Orangtua</label>
      <input aria-required="true" type="text" id="parentName" name="parentName" placeholder="Masukkan nama orangtua" required />

      <button type="submit" aria-label="Kirim data kelahiran">Kirim Data</button>
    </form>

    <div class="search-container">
      <input type="text" id="searchInput" placeholder="Cari data (nama anak, tempat, orangtua)..." aria-label="Cari data kelahiran" />
    </div>

    <div class="btn-group">
      <button id="downloadWord" aria-label="Unduh data kelahiran dalam file Word">Unduh Data Word</button>
      <button id="clearData" aria-label="Hapus semua data kelahiran tersimpan">Hapus Semua Data</button>
    </div>

    <section class="output" id="output" aria-live="polite" aria-atomic="true" hidden>
      <h2>Data Kelahiran Terakhir</h2>
      <p><strong>Nama Anak:</strong> <span id="outChildName"></span></p>
      <p><strong>Tempat Lahir:</strong> <span id="outPlace"></span></p>
      <p><strong>Tanggal Lahir:</strong> <span id="outDate"></span></p>
      <p><strong>Jenis Kelamin:</strong> <span id="outGender"></span></p>
      <p><strong>Nama Orangtua:</strong> <span id="outParent"></span></p>
    </section>

    <section class="saved-list" id="savedList" aria-live="polite" aria-atomic="true" hidden>
      <h2>Data Kelahiran Tersimpan</h2>
      <div id="recordsContainer"></div>
    </section>
  </div>

  <script>
    const STORAGE_KEY = 'birthDataRecords';

    function loadRecords() {
      const data = localStorage.getItem(STORAGE_KEY);
      if (!data) return [];
      try {
        return JSON.parse(data);
      } catch (error) {
        console.error('Gagal parsing data localStorage:', error);
        return [];
      }
    }

    function saveRecords(records) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const dateObj = new Date(dateStr);
      return isNaN(dateObj) ? dateStr : dateObj.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
    }

    function renderSavedRecords(filteredRecords = null) {
      const records = filteredRecords || loadRecords();
      const container = document.getElementById('recordsContainer');
      container.innerHTML = '';
      if (records.length === 0) {
        document.getElementById('savedList').hidden = true;
        return;
      }
      document.getElementById('savedList').hidden = false;
      records.forEach((rec, index) => {
        const div = document.createElement('div');
        div.className = 'record';
        div.setAttribute('tabindex', '0');
        div.innerHTML = `
          <p><strong>#${index + 1}</strong></p>
          <p><strong>Nama Anak:</strong> ${rec.childName}</p>
          <p><strong>Tempat Lahir:</strong> ${rec.placeOfBirth}</p>
          <p><strong>Tanggal Lahir:</strong> ${formatDate(rec.dateOfBirth)}</p>
          <p><strong>Jenis Kelamin:</strong> ${rec.gender}</p>
          <p><strong>Nama Orangtua:</strong> ${rec.parentName}</p>
        `;
        container.appendChild(div);
      });
    }

    function clearErrors() {
      document.getElementById('genderError').textContent = '';
    }

    function validateForm(form) {
      clearErrors();
      let valid = true;
      if (!form.childName.value.trim()) {
        alert('Nama Anak wajib diisi!');
        valid = false;
      }
      if (!form.placeOfBirth.value.trim()) {
        alert('Tempat Lahir wajib diisi!');
        valid = false;
      }
      if (!form.dateOfBirth.value) {
        alert('Tanggal Lahir wajib diisi!');
        valid = false;
      }
      const genderInputs = form.elements['gender'];
      let genderSelected = false;
      if (genderInputs) {
        if (genderInputs.length) {
          for (let i = 0; i < genderInputs.length; i++) {
            if (genderInputs[i].checked) {
              genderSelected = true;
              break;
            }
          }
        } else {
          if (genderInputs.checked) {
            genderSelected = true;
          }
        }
      }
      if (!genderSelected) {
        document.getElementById('genderError').textContent = 'Jenis Kelamin wajib dipilih!';
        valid = false;
      }
      if (!form.parentName.value.trim()) {
        alert('Nama Orangtua wajib diisi!');
        valid = false;
      }
      return valid;
    }

    document.getElementById('birthForm').addEventListener('submit', function(event) {
      event.preventDefault();
      if (!validateForm(this)) {
        return;
      }
      const childName = this.childName.value.trim();
      const place = this.placeOfBirth.value.trim();
      const date = this.dateOfBirth.value;
      const genderInputs = this.elements['gender'];
      let genderValue = '';
      if (genderInputs.length) {
        for (let i = 0; i < genderInputs.length; i++) {
          if (genderInputs[i].checked) {
            genderValue = genderInputs[i].value;
            break;
          }
        }
      } else {
        genderValue = genderInputs.value;
      }
      const parentName = this.parentName.value.trim();

      document.getElementById('outChildName').textContent = childName;
      document.getElementById('outPlace').textContent = place;
      document.getElementById('outDate').textContent = formatDate(date);
      document.getElementById('outGender').textContent = genderValue;
      document.getElementById('outParent').textContent = parentName;
      document.getElementById('output').hidden = false;

      const records = loadRecords();
      records.push({
        childName: childName,
        placeOfBirth: place,
        dateOfBirth: date,
        gender: genderValue,
        parentName: parentName
      });
      saveRecords(records);
      renderSavedRecords();
      this.reset();
      document.getElementById('searchInput').value = '';
    });

    // Export data as Word file for both HP and laptop
    function downloadWord() {
      const records = loadRecords();
      if (records.length === 0) {
        alert('Tidak ada data untuk diunduh.');
        return;
      }
      // HTML string for Word document export
      let htmlContent = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>Data Kelahiran</title><style>
        body { font-family: Arial, sans-serif; padding: 20px;}
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #555; padding: 8px; text-align: left; }
        th { background-color: #ccc; }
        h1 { text-align: center; }
      </style></head><body>`;
      htmlContent += '<h1>Data Kelahiran</h1>';
      htmlContent += '<table><tr><th>No.</th><th>Nama Anak</th><th>Tempat Lahir</th><th>Tanggal Lahir</th><th>Jenis Kelamin</th><th>Nama Orangtua</th></tr>';

      records.forEach((rec, i) => {
        const dateFormatted = new Date(rec.dateOfBirth);
        const dateStr = isNaN(dateFormatted) ? rec.dateOfBirth :
          dateFormatted.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
        htmlContent += `
          <tr>
            <td>${i + 1}</td>
            <td>${rec.childName}</td>
            <td>${rec.placeOfBirth}</td>
            <td>${dateStr}</td>
            <td>${rec.gender}</td>
            <td>${rec.parentName}</td>
          </tr>
        `;
      });
      htmlContent += '</table></body></html>';

      const blob = new Blob(['\ufeff', htmlContent], {type: 'application/msword'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'data_kelahiran.doc';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
    }

    function clearAllData() {
      if (confirm('Apakah Anda yakin ingin menghapus semua data kelahiran yang tersimpan?')) {
        localStorage.removeItem(STORAGE_KEY);
        document.getElementById('output').hidden = true;
        renderSavedRecords();
        document.getElementById('searchInput').value = '';
      }
    }

    document.getElementById('downloadWord').addEventListener('click', downloadWord);
    document.getElementById('clearData').addEventListener('click', clearAllData);

    // Search feature
    document.getElementById('searchInput').addEventListener('input', function() {
      const searchTerm = this.value.trim().toLowerCase();
      const allRecords = loadRecords();
      if (!searchTerm) {
        renderSavedRecords(allRecords);
        return;
      }
      const filteredRecords = allRecords.filter(rec => {
        return (
          (rec.childName && rec.childName.toLowerCase().includes(searchTerm)) ||
          (rec.placeOfBirth && rec.placeOfBirth.toLowerCase().includes(searchTerm)) ||
          (rec.parentName && rec.parentName.toLowerCase().includes(searchTerm))
        );
      });
      renderSavedRecords(filteredRecords);
    });

    window.addEventListener('load', () => {
      renderSavedRecords();
    });
  </script>
</body>
</html>
